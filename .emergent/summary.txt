<analysis>**original_problem_statement:**
The user initially wanted to fix a deleted database for their PHP e-commerce site, . The scope has since expanded to a full rebuild and feature enhancement of the legacy PHP application. The current session focused on completing a complex Biteship shipping integration and has now moved on to building a highly detailed, brand-new voucher system.

PRODUCT REQUIREMENTS:
1.  **Biteship Integration (Now considered complete):** A full-featured integration including live rate calculation, order creation, webhook handling for status updates, a complete admin order management panel with advanced search, and a batch printing system for A6 shipping labels. The user also requested a customer-facing tracking page and an admin-facing error log viewer.
2.  **Voucher System (New & In Progress):**
    *   Create a full voucher management system in the admin panel (CRUD operations).
    *   Support two distinct voucher types: **Free Shipping** (fixed amount reduction on shipping cost) and **Discount** (percentage or fixed amount reduction on cart total).
    *   Allow customers to **use two vouchers simultaneously** at checkout (one of each type).
    *   Implement a **modal at checkout** where users can see all their available vouchers and select which ones to apply.
    *   Admin should be able to set **voucher conditions**, such as minimum purchase amount.
    *   Admin can **upload an image/icon** for each voucher, which should be displayed in the checkout modal.
    *   Vouchers should have associated **Terms & Conditions (S&K)**.
3.  **Payment Gateway Integration:** (Upcoming) Integrate a payment gateway like Midtrans.
4.  **Business Growth Dashboard:** (Future) A dashboard showing daily/monthly stats.
5.  **Fix Broken Admin Pages:** (Future) Fix or remove the non-functional  and  pages.

**User's preferred language**: The user's primary language is **Indonesian (Bahasa Indonesia)**. The next agent MUST respond in Indonesian.

**what currently exists?**
The application is a monolithic legacy PHP e-commerce site. The agent's development environment does not run the PHP/MySQL stack; therefore, the established workflow is for the agent to write PHP code and SQL migration scripts, which the user then deploys and executes on their own production server. The complex Biteship shipping integration is now considered feature-complete by the agent, with numerous backend, admin, and customer-facing features having been built. The agent has just begun work on a new, highly detailed voucher system, starting with the database migration script.

**Last working item**:
-   **Last item agent was working:** The agent was creating the database migration script () for the new, comprehensive voucher system. The script failed to execute due to an SQL error when inserting sample data.
-   **Status:** IN PROGRESS
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** NA. The development workflow involves creating PHP files and migration scripts for the user to execute on their own server. The agent cannot directly test the application.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: Voucher System migration script fails** (P0)

**Issues Detail:**
-   **Issue 1: Voucher System migration script fails**
    -   **Attempted fixes:** The agent created the script . The user ran it and reported an SQL error: . The agent attempted a fix by correcting column names, but the error persisted, likely because the  table was already partially created from the first failed attempt. The agent's last action was to edit the script again, this time planning to skip the insertion of sample data to avoid the error.
    -   **Next debug checklist:**
        1.  Review the edited  to ensure the problematic  statements for sample vouchers are removed or corrected.
        2.  The script should ideally be idempotent, either by using  for table creation or by including  statements at the beginning to ensure a clean slate on each run.
        3.  Inform the user of the updated script and provide clear instructions to run it again.
    -   **Why fix this issue and what will be achieved with the fix?** This is a **blocker** for the entire voucher system feature. The database schema must be successfully created before any other development on this feature can proceed.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** Backend (The user must test the migration script on their server).
    -   **Blocked on other issue:** None.

**In progress Task List**:
-   **Task 1: Build the complete Voucher System** (P0)

**Task Detail:**
-   **Task 1: Build the complete Voucher System**
    -   **Where to resume:** Immediately after fixing the migration script (Issue 1), the agent must create the full suite of files for the voucher system. The agent has already created two API files (, ) but still needs to build:
        1.  The full admin panel for voucher CRUD operations ().
        2.  The checkout page modifications to include a Use Voucher button.
        3.  The frontend modal for selecting available vouchers.
        4.  The JavaScript logic to apply vouchers to the cart and recalculate totals.
    -   **What will be achieved with this?** A complete, professional voucher system as per the user's detailed specifications, seamlessly integrated into the checkout flow.
    -   **Status:** IN PROGRESS
    -   **Should Test frontend/backend/both after fix?** Both (user will test on their server).
    -   **Blocked on something:** **Issue 1: Voucher System migration script fails**.

**Upcoming and Future Tasks**
-   **P0: Payment Gateway Integration:** The user has confirmed this is the next major feature after the expedition/shipping system is complete. The agent proposed Midtrans, Xendit, or Doku.
-   **P1: Build Business Growth Dashboard:** Implement the backend logic and frontend for the admin dashboard.
-   **P2: Enhance Product Detail Page:** Add Customer Reviews and You Might Also Like sections.
-   **P2: Complete User Management Features:** Implement the admin's ability to add/subtract from a user's wallet.
-   **P3: Fix Remaining Broken Admin Pages:** Address the  and  pages.
-   **P3: Overhaul Referral System:** Revisit the original request for a percentage-based referral system.

**Completed work in this session**
-   **Clarified Development Workflow:** The agent and user established a critical workflow: the agent writes PHP code and SQL migration scripts, and the user deploys/executes them on their own production server. This resolved major confusion about the development environment.
-   **Biteship Integration Completion:**
    -   Upgraded the admin Orders page () with powerful multi-field search (by Order ID, Order Number, Customer, etc.) and status tabs.
    -   Added a customer-facing order tracking system, including a Track Paket button on the My Orders page () that opens a real-time tracking modal.
    -   Implemented an admin-facing error log viewer () for easier debugging of Biteship webhooks.
    -   Improved the shipping rate calculation API () to automatically filter out couriers unavailable for a given destination.
    -   Created an all-in-one PHP migration script () to handle all Biteship-related database schema changes.
    -   Provided extensive documentation and step-by-step installation guides to the user.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: You Might Also Like & Reviews sections.** On the product detail page.
-   **Issue 2: Broken Admin Pages (, ).**

**Known issue recurrence from previous fork**
-   The issue of broken admin pages (, ) persists from the previous session and has not yet been prioritized.

**Code Architecture**
-   **Monolithic Legacy PHP Application:** No framework detected. Code is procedural.
-   **Development Model:** The agent acts as an offline developer, producing code and SQL migration scripts (wrapped in user-friendly PHP files) for the user to execute on their own live server. Direct testing within the agent's environment is not possible.
-   **Directory Structure:** Standard PHP structure with top-level directories like , , , .

**Key Technical Concepts**
-   **Backend:** PHP (procedural)
-   **Database:** MySQL (on user's server, managed via PDO in PHP)
-   **Frontend:** HTML, CSS, JavaScript (jQuery)
-   **Key Integrations:** Biteship Shipping API

**key DB schema**
-   : {id, user_id, order_number, total_payable_amount, payment_status, shipping_status, **fulfillment_status**, **shipping_courier**, **shipping_service**, **shipping_cost**, **tracking_number**, **notes**}
-   : Renamed to .
-   : {id, received_at, headers, body, status}
-   : {id, batch_code, printed_at}
-   : Stores shipping/billing address per order.
-   **(New)** : {id, code, type ('DISCOUNT', 'FREE_SHIPPING'), value, max_value, min_purchase, start_date, end_date, image_icon, terms, is_active}
-   **(New)** : {id, user_id, voucher_id, is_used, used_at}

**All files of reference**
-   **Voucher System (In Progress):**
    -    (The failing migration script, needs fixing)
    -    (Created)
    -    (Created)
-   **Biteship Completion (Recent):**
    -    (Rewritten with advanced search)
    -    (Updated with tracking button)
    -    (New)
    -    (New)
    -    (New)
    -    (Updated to filter unavailable couriers)
    -    (Biteship DB setup script)
    -   ,  (Documentation)

**Critical Info for New Agent**
-   **WORKFLOW IS KEY:** You are not working on a live, testable application. Your role is to produce PHP code and self-executing PHP migration scripts (). The user will take these files and run them on their own production server. All instructions and explanations must be extremely clear.
-   **PRIORITY:** The immediate task is to **fix the failing voucher system migration script** (). This is a hard blocker for the user's current request.
-   After fixing the migration script, proceed to build the rest of the voucher system feature, which is a large task.
-   The Biteship integration is considered functionally complete. Do not revisit it unless the user reports a specific bug. The next major integration will be a payment gateway.

**documents created in this job**
-   
-   
-   
-   
-   
-   

**Last 10 User Messages and any pending user messages**
1.  **User:** Asks for a powerful admin search on the orders page by Order ID.
2.  **Agent:** Implements the advanced search on .
3.  **User:** Confirms that unavailable couriers should not appear at checkout.
4.  **Agent:** Updates the  API to filter unavailable couriers.
5.  **User:** Asks for confirmation that shipping price estimates are shown, asks about SQL migrations, and confirms if the Biteship integration is fully connected before moving to payment gateway integration.
6.  **Agent:** Provides a detailed, comprehensive confirmation that all Biteship features are complete and connected, and reminds the user about the  file for DB changes. Asks which payment gateway to integrate next.
7.  **User:** Pivots to a new, large feature request: a complex voucher system with free shipping & discount types, ability to use two at once, admin management with image uploads, and a checkout modal.
8.  **Agent:** Acknowledges the request and starts by creating the DB migration script ().
9.  **User:** Reports the migration script failed with an SQL error ().
10. **Agent:** Attempts to fix the script, but the user reports the same error again. The agent identifies the recurring issue and decides on a new fix (skipping sample data).

**Project Health Check:**
-   **Broken:**
    -   The new **Voucher System** is blocked by a failing database migration script ().
-   **Needs User Testing:**
    -   The entire **Biteship Integration**, while feature-complete from the agent's side, needs to be fully deployed and tested by the user on their server.
-   **Mocked:** None.

**3rd Party Integrations**:
-   **Biteship:** Shipping API. Requires a User API Key. Status: Functionally complete, pending user deployment and testing.

**Testing status**
-   **Testing agent used after significant changes:** NO (Not applicable for this workflow)
-   **Troubleshoot agent used after agent stuck in loop:** YES, the agent correctly used the troubleshoot agent to identify the initial environment mismatch (PHP/MySQL vs the provided React/Mongo env).
-   **Test files created:** None.
-   **Known regressions:**  and  admin pages remain broken from a previous session.

**Credentials to test flow:**
-   **Role:** Admin
-   **User 1:**  / 
-   **User 2:**  / 
(Note: These are for the user's production site. The agent cannot use them.)

**What agent forgot to execute**
-   The agent is currently focused on the user's immediate, high-priority requests. Lower-priority tasks from the initial handoff (Business Growth Dashboard, Product Page enhancements, etc.) have been deferred, not forgotten.</analysis>
